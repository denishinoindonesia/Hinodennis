# =====================================
# üîí SECURITY CONFIG - ADMIN
# =====================================

# 1Ô∏è‚É£ Disable directory listing
Options -Indexes

# 2Ô∏è‚É£ Force HTTPS (hanya jika admin bisa diakses tanpa root rules)
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 3Ô∏è‚É£ Block sensitive files inside admin
<FilesMatch "(^\.|config\.php|koneksi\.php|\.env|\.git|composer\.json|composer\.lock|package\.json|yarn\.lock|\.htpasswd)">
    Order allow,deny
    Deny from all
</FilesMatch>

# 4Ô∏è‚É£ Allow login system files
<FilesMatch "(cek_login\.php|proses_login\.php|hapus_.*\.php|edit_.*\.php|tambah_.*\.php|login\.php)">
    Order allow,deny
    Allow from all
</FilesMatch>

# 5Ô∏è‚É£ Prevent PHP execution in uploads folder
RewriteCond %{REQUEST_URI} ^/admin/api/uploads [NC]
RewriteCond %{REQUEST_FILENAME} \.(php|php3|php4|php5|phtml|html|htm)$ [NC]
RewriteRule .* - [F,L]

# 6Ô∏è‚É£ Extra protection for uploads directory
<Directory "api/uploads">
    <FilesMatch "\.(php|php3|php4|php5|phtml|phps)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
</Directory>

# 7Ô∏è‚É£ Block harmful uploads
<FilesMatch "\.(phps|php5|phtml|exe|sh|bat|pl|py|jsp|asp)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# 8Ô∏è‚É£ Protect .htaccess itself
<Files ".htaccess">
    Order allow,deny
    Deny from all
</Files>

# 9Ô∏è‚É£ Block suspicious query strings (LFI/RFI/command injection)
RewriteCond %{QUERY_STRING} (\.\./|\.\.\\|/etc/passwd|/bin/bash|base64_encode|eval\(|system\(|shell_exec\() [NC]
RewriteRule .* - [F,L]

# üîü Block bot scanners (safe for SEO)
SetEnvIfNoCase User-Agent "curl" bad_bot
SetEnvIfNoCase User-Agent "wget" bad_bot
SetEnvIfNoCase User-Agent "python" bad_bot
SetEnvIfNoCase User-Agent "nikto" bad_bot
SetEnvIfNoCase User-Agent "fimap" bad_bot
SetEnvIfNoCase User-Agent "sqlmap" bad_bot
Order allow,deny
Allow from all
Deny from env=bad_bot

# 11Ô∏è‚É£ Block suspicious IP ranges
<Limit GET POST>
    Order Allow,Deny
    Allow from all
    Deny from 45.146.165.0/24
    Deny from 185.220.100.0/22
    Deny from 91.240.118.0/23
</Limit>
